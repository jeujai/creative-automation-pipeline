# Implementation Plan

- [x] 1. Set up project structure and core configuration
  - Create directory structure for modules (parsers, managers, clients, compositors, utils)
  - Create requirements.txt with dependencies (pillow, pyyaml, openai, requests)
  - Create config.yaml template with all configuration sections
  - Create .env.example for API key management
  - _Requirements: 6.1, 6.6, 6.7, 7.1, 7.4_

- [x] 2. Implement data models and campaign brief parser
  - [x] 2.1 Create data model classes using dataclasses
    - Define CampaignBrief, Product, Localization, PipelineResult, GeneratedAsset classes
    - Add validation methods to ensure required fields are present
    - _Requirements: 1.3, 1.4, 1.5, 1.6, 1.7_
  - [x] 2.2 Implement BriefParser class
    - Write JSON parsing logic
    - Write YAML parsing logic
    - Implement format detection from file extension
    - Add validation for required brief fields
    - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5, 1.6_
  - [x] 2.3 Write unit tests for brief parser
    - Test valid JSON and YAML parsing
    - Test missing required fields
    - Test malformed input files
    - _Requirements: 1.1, 1.2_

- [x] 3. Implement Asset Manager for storage operations
  - [x] 3.1 Create AssetManager class with file operations
    - Implement get_asset() to check and load existing assets
    - Implement save_asset() with organized directory structure
    - Create directory structure: output/{campaign_id}/{product_id}/{aspect_ratio}_filename
    - Add support for multiple image formats (PNG, JPG, JPEG)
    - _Requirements: 2.1, 2.2, 2.4, 2.5, 5.1, 5.2, 5.3, 5.4, 5.5_
  - [x] 3.2 Implement output organization logic
    - Create organize_outputs() method to structure final outputs
    - Generate clear, descriptive filenames with aspect ratio prefix
    - _Requirements: 5.2, 5.3, 5.4_
  - [x] 3.3 Write unit tests for asset manager
    - Test asset retrieval with existing and missing files
    - Test output directory creation and organization
    - Test filename generation
    - _Requirements: 2.1, 2.2, 5.1, 5.2, 5.3_

- [x] 4. Implement GenAI Image Client
  - [x] 4.1 Create GenAIClient base class and OpenAI implementation
    - Implement GenAIClient interface with generate_image() method
    - Create OpenAIClient subclass using DALL-E 3 API
    - Implement prompt building logic with product, audience, and region context
    - Add error handling with retry logic (max 3 attempts with exponential backoff)
    - _Requirements: 2.3_
  - [x] 4.2 Add API response handling and image download
    - Parse API response and extract image URL
    - Download generated image and convert to PIL Image object
    - Handle API errors (rate limits, invalid responses, network issues)
    - _Requirements: 2.3_
  - [x] 4.3 Write integration tests with mocked API
    - Test successful image generation
    - Test API error handling and retries
    - Test prompt construction
    - _Requirements: 2.3_

- [x] 5. Implement Image Compositor for aspect ratios and text overlay
  - [x] 5.1 Create ImageCompositor class with aspect ratio handling
    - Implement create_variants() to generate 1:1, 9:16, and 16:9 versions
    - Implement smart cropping logic for each aspect ratio (center crop for 1:1, top-focused for 9:16, center for 16:9)
    - Ensure high-quality resizing with appropriate resampling
    - _Requirements: 3.1, 3.2, 3.3, 3.4, 3.5_
  - [x] 5.2 Implement text overlay functionality
    - Create add_text_overlay() method with configurable positioning
    - Add semi-transparent background overlay for text contrast
    - Implement text wrapping for long messages
    - Scale font size based on image dimensions
    - Support English text rendering
    - _Requirements: 4.1, 4.2, 4.3, 4.4_
  - [x] 5.3 Add contrast enhancement for text readability
    - Analyze text region brightness
    - Add or adjust overlay opacity to ensure sufficient contrast
    - _Requirements: 4.4_
  - [x] 5.4 Write unit tests for image compositor
    - Test aspect ratio calculations and cropping
    - Test text overlay positioning and contrast
    - Test with various image sizes
    - _Requirements: 3.1, 3.2, 3.3, 4.1, 4.2, 4.3_

- [x] 6. Implement optional Compliance Checker
  - [x] 6.1 Create ComplianceChecker class with brand validation
    - Implement check_brand_compliance() for logo detection using template matching
    - Implement color analysis to verify brand colors
    - Return ComplianceResult with pass/fail status and details
    - _Requirements: 8.1, 8.2, 8.3, 8.4_
  - [x] 6.2 Implement legal content checking
    - Create check_legal_compliance() to scan for prohibited words
    - Load prohibited terms from configuration
    - Implement case-insensitive pattern matching
    - Flag violations with severity levels
    - _Requirements: 9.1, 9.2, 9.3, 9.4_
  - [x] 6.3 Write unit tests for compliance checker
    - Test logo detection with present and absent logos
    - Test color validation
    - Test prohibited word detection
    - _Requirements: 8.1, 8.2, 9.1, 9.2_

- [x] 7. Implement Logger and Reporter
  - [x] 7.1 Create PipelineLogger class
    - Implement log_operation() to record individual operations
    - Configure logging levels (INFO, WARNING, ERROR, DEBUG)
    - Write logs to both console and file
    - _Requirements: 10.1, 10.2_
  - [x] 7.2 Implement report generation
    - Create generate_report() to produce execution summary
    - Include campaign ID, timestamp, products processed, assets reused vs generated
    - Include success/failure status, compliance results, execution time
    - Output report as JSON file
    - _Requirements: 10.1, 10.2, 10.3, 10.4, 10.5_
  - [x] 7.3 Write unit tests for logger and reporter
    - Test log writing and formatting
    - Test report generation with various scenarios
    - _Requirements: 10.1, 10.2, 10.4_

- [x] 8. Implement Pipeline Orchestrator
  - [x] 8.1 Create PipelineOrchestrator class
    - Implement run() method as main execution entry point
    - Implement _validate_brief() to check required fields
    - Create _process_product() to handle single product through pipeline
    - Coordinate all components (parser, asset manager, GenAI client, compositor)
    - _Requirements: 1.3, 1.4, 1.5, 1.6, 2.1, 2.2, 2.3, 3.1, 3.2, 3.3, 4.1, 4.2, 5.1, 5.2, 5.3_
  - [x] 8.2 Implement pipeline execution flow
    - Parse campaign brief
    - For each product: check for existing asset, generate if missing, create variants, apply text overlay
    - Save all outputs with organized structure
    - Generate execution report
    - _Requirements: 2.1, 2.2, 2.3, 3.1, 3.2, 3.3, 4.1, 4.2, 5.1, 5.2, 5.3, 5.4, 5.5_
  - [x] 8.3 Add error handling and recovery
    - Handle errors at each pipeline stage gracefully
    - Continue processing other products if one fails
    - Log all errors with context
    - Return appropriate exit codes
    - _Requirements: 7.1, 7.2, 7.3, 7.4, 7.5_
  - [x] 8.4 Write integration tests for orchestrator
    - Test end-to-end pipeline with mock components
    - Test error handling and recovery
    - Test with multiple products
    - _Requirements: 1.7, 2.1, 2.2, 2.3, 3.1, 3.2, 3.3_

- [x] 9. Create CLI interface and main entry point
  - [x] 9.1 Implement command-line interface using argparse
    - Add --brief argument for campaign brief file path
    - Add --config argument for custom configuration file
    - Add --compliance flag to enable compliance checks
    - Add --verbose flag for debug logging
    - _Requirements: 7.2, 7.3_
  - [x] 9.2 Create main execution script (pipeline.py)
    - Parse command-line arguments
    - Load configuration from file and environment variables
    - Initialize PipelineOrchestrator with configuration
    - Execute pipeline and handle results
    - Print summary to console
    - _Requirements: 7.1, 7.2, 7.3, 7.4, 7.5_
  - [x] 9.3 Add configuration loading and validation
    - Load config.yaml with defaults
    - Override with environment variables
    - Validate required configuration (API keys, directories)
    - _Requirements: 6.7, 7.1, 7.4_

- [x] 10. Create documentation and examples
  - [x] 10.1 Write comprehensive README.md
    - Document installation steps and dependencies
    - Provide usage examples with command-line options
    - Document configuration file structure
    - Explain input brief format with examples
    - Show example output structure
    - Document key design decisions
    - List assumptions and limitations
    - _Requirements: 6.1, 6.2, 6.3, 6.4, 6.5, 6.6, 6.7_
  - [x] 10.2 Create example campaign briefs
    - Create example_brief.json with 2 products
    - Create example_brief.yaml with 2 products
    - Include comments explaining each field
    - _Requirements: 1.1, 1.2, 1.7, 6.3_
  - [x] 10.3 Create sample input assets
    - Add 1-2 sample product images to input_assets/ directory
    - Document expected input asset naming convention
    - _Requirements: 2.1, 2.4, 6.3_
  - [x] 10.4 Document configuration options
    - Create config.yaml with all options and comments
    - Document environment variable usage
    - Explain optional features (compliance, logging)
    - _Requirements: 6.5, 6.6, 6.7_

- [x] 11. Final integration and validation
  - [x] 11.1 Run end-to-end test with real GenAI API
    - Execute pipeline with example brief
    - Verify all aspect ratios generated correctly
    - Verify text overlay applied properly
    - Verify output organization matches specification
    - _Requirements: 1.7, 2.1, 2.2, 2.3, 3.1, 3.2, 3.3, 4.1, 4.2, 5.1, 5.2, 5.3, 5.4, 5.5, 7.5_
  - [x] 11.2 Validate with asset reuse scenario
    - Run pipeline with existing input assets
    - Verify assets are reused instead of regenerated
    - Verify logging indicates reuse vs generation
    - _Requirements: 2.1, 2.2, 10.3_
  - [x] 11.3 Test optional compliance features
    - Enable compliance checks in configuration
    - Run pipeline and verify compliance reports generated
    - Test with both compliant and non-compliant scenarios
    - _Requirements: 8.1, 8.2, 8.3, 8.4, 9.1, 9.2, 9.3, 9.4_
  - [x] 11.4 Perform manual visual quality review
    - Review generated images for visual quality
    - Verify text readability across all aspect ratios
    - Check aspect ratio cropping quality
    - Validate overall creative output meets expectations
    - _Requirements: 3.4, 4.3, 4.4, 5.5_
